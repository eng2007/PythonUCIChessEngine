# OpusChess - UCI Chess Engine

Шахматный движок на чистом Python с поддержкой протокола UCI.

## Возможности

### Правила шахмат (FIDE)
- ✅ Все ходы фигур (пешка, конь, слон, ладья, ферзь, король)
- ✅ Рокировка (короткая O-O и длинная O-O-O)
- ✅ Взятие на проходе (en passant)
- ✅ Превращение пешки (в ферзя, ладью, слона, коня)
- ✅ Шах, мат, пат
- ✅ Правило 50 ходов
- ✅ Троекратное повторение позиции
- ✅ Недостаточность материала для мата

### Протокол UCI
- ✅ `uci` - идентификация движка
- ✅ `isready` / `readyok` - проверка готовности
- ✅ `ucinewgame` - новая игра
- ✅ `position startpos [moves ...]` - начальная позиция
- ✅ `position fen <fen> [moves ...]` - позиция из FEN
- ✅ `go depth <n>` - поиск на глубину n
- ✅ `stop` - остановить поиск
- ✅ `quit` - выход

### Движок поиска
- ✅ Minimax с альфа-бета отсечением
- ✅ Итеративное углубление
- ✅ Quiescence search (поиск спокойствия)
- ✅ Упорядочивание ходов (MVV-LVA)
- ✅ Piece-square tables для оценки позиции
- ✅ **Транспозиционная таблица** (Zobrist hashing, 64MB кэш)
- ✅ TT move ordering (лучший ход из кэша первым)
- ✅ **Null Move Pruning** (пропуск хода для отсечения)
- ✅ **Late Move Reductions** (сокращённый поиск для поздних ходов)
- ✅ **Killer Move Heuristic** (запоминание ходов с отсечением)
- ✅ **History Heuristic** (статистика успешных ходов)
- ✅ **Principal Variation Search** (PVS)

### Улучшенная оценка позиции
- ✅ Структура пешек (сдвоенные, изолированные, проходные, цепи)
- ✅ Безопасность короля (пешечный щит, открытые линии)
- ✅ Активность фигур (пара слонов, ладьи на открытых линиях, на 7-й горизонтали)
- ✅ Мобильность фигур (кони, слоны, ладьи, ферзь)
- ✅ Контроль центра

## Запуск

```bash
python main.py
```

После запуска движок ожидает UCI-команды из stdin.

## Использование с GUI

1. Откройте любую UCI-совместимую программу (Arena, CuteChess, и т.д.)
2. Добавьте движок: укажите путь к `main.py`
3. Начните играть!

## Пример использования в консоли

```
> uci
id name OpusChess 1.0
id author AI Assistant
option name Depth type spin default 4 min 1 max 20
uciok

> isready
readyok

> position startpos
> go depth 4
info depth 4 nodes 12345 score cp 25
bestmove e2e4

> position startpos moves e2e4 e7e5
> go depth 4
info depth 4 nodes 10234 score cp 15
bestmove g1f3

> quit
```

## Структура проекта

```
├── main.py              # Точка входа
├── board.py             # Представление доски, FEN, ходы
├── move_generator.py    # Генерация легальных ходов
├── evaluation.py        # Оценка позиции
├── search.py            # Поиск лучшего хода
├── uci.py               # UCI протокол
└── README.md            # Документация
```

## Отладочные команды

Дополнительные команды (не входят в стандарт UCI):

- `d` - показать доску в текстовом виде
- `perft <depth>` - подсчёт узлов (для тестирования)

## Требования

- Python 3.8+
- Без внешних зависимостей

## Лицензия

MIT License
